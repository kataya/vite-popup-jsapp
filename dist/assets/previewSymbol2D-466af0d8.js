import{fd as L,cg as z,cf as w,fe as q,ff as A,fg as R,a as V,fh as E,fi as W,fj as H,fk as x,fl as U}from"./index-b5294fcf.js";import{c as $}from"./fontUtils-3e81ad04.js";function G(a){let{r:e,g:l,b:n,a:i}=a;return i<1&&(e=Math.round(i*e+255*(1-i)),l=Math.round(i*l+255*(1-i)),n=Math.round(i*n+255*(1-i))),new L({r:e,g:l,b:n})}function D(a,e){const{r:l,g:n,b:i}=e!=null&&e.ignoreAlpha?a:G(a);return .2126*l+.7152*n+.0722*i}const O="picture-fill",I="picture-marker",J="simple-fill",K="simple-line",N="simple-marker",Q="text",X="Aa",Y=z.size,M=z.maxSize,_=z.maxOutlineSize,ee=z.lineWidth,T=225,ae=document.createElement("canvas");function P(a,e){const l=ae.getContext("2d"),n=[];return e&&(e.weight&&n.push(e.weight),e.size&&n.push(e.size+"px"),e.family&&n.push(e.family)),l.font=n.join(" "),l.measureText(a).width}const ne=7.2/2.54,le=72/2.54;function ie(a){if(a.length===0)return 0;if(a.length>2){const e=U(1),l=parseFloat(a);switch(a.slice(-2)){case"px":return l;case"pt":return l*e;case"in":return 72*l*e;case"pc":return 12*l*e;case"mm":return l*ne*e;case"cm":return l*le*e}}return parseFloat(a)}function k(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?w(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?w(e.height):null}}async function oe(a,e){const l=e.fill,n=a.color;if((l==null?void 0:l.type)==="pattern"&&n&&a.type!==O){const i=await H(l.src,n.toCss(!0));l.src=i,e.fill=l}}async function se(a,e,l,n){var p,r,c;if(!("font"in a)||!a.font||e.shape.type!=="text")return;try{await $(a.font)}catch{}const{width:i}=k(n),u=/[\uE600-\uE6FF]/.test(e.shape.text);i!=null||u||(l[0]=P(e.shape.text,{weight:(p=e.font)==null?void 0:p.weight,size:(r=e.font)==null?void 0:r.size,family:(c=e.font)==null?void 0:c.family}))}function te(a,e,l,n,i){var u;if(a.haloColor!=null&&a.haloSize!=null){i.masking??(i.masking=l.map(()=>[]));const p=w(a.haloSize);n[0]+=p,n[1]+=p,l.unshift([{...e,fill:null,stroke:{color:a.haloColor,width:2*p,join:"round",cap:"round"}}]),i.masking.unshift([{shape:{type:"rect",x:0,y:0,width:n[0]+2*x,height:n[1]+2*x},fill:[255,255,255],stroke:null},{...e,fill:[0,0,0,0],stroke:null}])}a.backgroundColor==null&&a.borderLineColor==null||(n[0]+=2*x,n[1]+=2*x,l.unshift([{shape:{type:"rect",x:0,y:0,width:n[0],height:n[1]},fill:a.backgroundColor,stroke:{color:a.borderLineColor,width:w(a.borderLineSize)}}]),(u=i.masking)==null||u.unshift([]))}function Z(a,e){return a>e?"dark":"light"}function re(a,e){var C,S;const l=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,n=l!=null?w(l):null,i=(e==null?void 0:e.maxSize)!=null?w(e.maxSize):null,u=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,p=q(a);let r=A(a);ce(a,245)!=="dark"||e!=null&&e.ignoreWhiteSymbols||(r={width:.75,...r,color:"#bdc3c7"});const c={shape:null,fill:p,stroke:r,offset:[0,0]};r!=null&&r.width&&(r.width=Math.min(r.width,_));const d=(r==null?void 0:r.width)||0;let g=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),o=0,s=0,v=!1;switch(a.type){case N:{const h=a.style,{width:m,height:t}=k(e),b=m===t&&m!=null?m:n??Math.min(w(a.size),i||M);switch(o=b,s=b,h){case"circle":c.shape={type:"circle",cx:0,cy:0,r:.5*b},g||(o+=d,s+=d);break;case"cross":c.shape={type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[o,.5*s]},{command:"M",values:[.5*o,0]},{command:"L",values:[.5*o,s]}]};break;case"diamond":c.shape={type:"path",path:[{command:"M",values:[0,.5*s]},{command:"L",values:[.5*o,0]},{command:"L",values:[o,.5*s]},{command:"L",values:[.5*o,s]},{command:"Z",values:[]}]},g||(o+=d,s+=d);break;case"square":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,s]},{command:"L",values:[0,s]},{command:"Z",values:[]}]},g||(o+=d,s+=d),u&&(v=!0);break;case"triangle":c.shape={type:"path",path:[{command:"M",values:[.5*o,0]},{command:"L",values:[o,s]},{command:"L",values:[0,s]},{command:"Z",values:[]}]},g||(o+=d,s+=d),u&&(v=!0);break;case"x":c.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,s]},{command:"M",values:[o,0]},{command:"L",values:[0,s]}]},u&&(v=!0);break;case"path":c.shape={type:"path",path:a.path||""},g||(o+=d,s+=d),u&&(v=!0),g=!0}break}case K:{const{width:h,height:m}=k(e),t=m??n??d,b=h??ee;r&&(r.width=t),o=b,s=t;const y=((C=c==null?void 0:c.stroke)==null?void 0:C.cap)||"butt",f=y==="round";g=!0,c.stroke&&(c.stroke.cap=y==="butt"?"square":y),c.shape={type:"path",path:[{command:"M",values:[f?t/2:0,s/2]},{command:"L",values:[f?o-t/2:o,s/2]}]};break}case O:case J:{const h=typeof(e==null?void 0:e.symbolConfig)=="object"&&!!((S=e==null?void 0:e.symbolConfig)!=null&&S.isSquareFill),{width:m,height:t}=k(e);o=!h&&m!==t||m==null?n??Y:m,s=!h&&m!==t||t==null?o:t,g||(o+=d,s+=d),g=!0,c.shape=h?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[o,0]},{command:"L",values:[o,s]},{command:"L",values:[0,s]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:R.fill[0];break}case I:{const h=Math.min(w(a.width),i||M),m=Math.min(w(a.height),i||M),{width:t,height:b}=k(e),y=t===b&&t!=null?t:n??Math.max(h,m),f=h/m;o=f<=1?Math.ceil(y*f):y,s=f<=1?y:Math.ceil(y/f),c.shape={type:"image",x:-Math.round(o/2),y:-Math.round(s/2),width:o,height:s,src:a.url||""},u&&(v=!0);break}case Q:{const h=a,m=(e==null?void 0:e.overrideText)||h.text||X,t=h.font,{width:b,height:y}=k(e),f=y??n??Math.min(w(t.size),i||M),B=P(m,{weight:t.weight,size:f,family:t.family}),j=/[\uE600-\uE6FF]/.test(m);o=b??(j?f:B),s=f;let F=.25*ie((t?f:0).toString());j&&(F+=5),c.shape={type:"text",text:m,x:h.xoffset||0,y:h.yoffset||F,align:"middle",alignBaseline:h.verticalAlignment,decoration:t&&t.decoration,rotated:h.rotated,kerning:h.kerning},c.font=t&&{size:f,style:t.style,decoration:t.decoration,weight:t.weight,family:t.family};break}}return{shapeDescriptor:c,size:[o,s],renderOptions:{node:e==null?void 0:e.node,scale:g,opacity:e==null?void 0:e.opacity,rotation:u,useRotationSize:v,effectView:e==null?void 0:e.effectView,ariaLabel:e==null?void 0:e.ariaLabel}}}async function me(a,e){var p;const{shapeDescriptor:l,size:n,renderOptions:i}=re(a,e);if(!l.shape)throw new V("symbolPreview: renderPreviewHTML2D","symbol not supported.");await oe(a,l),await se(a,l,n,e);const u=[[l]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&((p=e==null?void 0:e.symbolConfig)!=null&&p.applyColorModulation)){const r=.6*n[0];u.unshift([{...l,offset:[-r,0],fill:E(l.fill,-.3)}]),u.push([{...l,offset:[r,0],fill:E(l.fill,.3)}]),n[0]+=2*r,i.scale=!1}return a.type==="text"&&te(a,l,u,n,i),W(u,n,i)}function ce(a,e=T){const l=q(a),n=A(a),i=!l||"type"in l?null:new L(l),u=n!=null&&n.color?new L(n==null?void 0:n.color):null,p=i?Z(D(i),e):null,r=u?Z(D(u),e):null;return r?p?p===r?p:e>=T?"light":"dark":r:p}export{ce as getContrastingBackgroundTheme,re as getRenderSymbolParameters,me as previewSymbol2D};
